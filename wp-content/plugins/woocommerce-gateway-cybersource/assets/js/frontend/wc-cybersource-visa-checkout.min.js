"use strict";var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),_get=function e(t,n,i){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);return void 0!==o?"value"in o?o.value:void 0!==(o=o.get)?o.call(i):void 0:null!==(o=Object.getPrototypeOf(t))?e(o,n,i):void 0};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}jQuery(function(t){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.ready=!1,t.api_key=e.api_key,t.settings=e.settings,t.i18n=e.i18n,t.init(),t}window.WC_Cybersource_Visa_Checkout_Payment_Form_Handler=(_inherits(n,SV_WC_Payment_Form_Handler_v5_11_12),_createClass(n,[{key:"init",value:function(){this.ready||void 0!==window.V&&void 0!==window.V.init&&0!==t("#wc-"+this.id_dasherized+"-container .v-button").length&&(this.ready=!0,this.add_event_handlers(),this.set_payment_fields())}},{key:"set_payment_fields",value:function(){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"set_payment_fields",this).call(this),this.ready&&(this.$container=t("#wc-"+this.id_dasherized+"-container"),this.$button=this.$container.find(".v-button"),this.show_button(),this.init_visa_checkout(),this.toggle_order_button())}},{key:"validate_payment_data",value:function(){return 0!==this.get_payment_response().length||(this.render_errors([this.i18n.missing_payment_response_message]),!1)}},{key:"get_payment_response",value:function(){return t("#wc-"+this.id_dasherized+"-payment-response").val()}},{key:"init_visa_checkout",value:function(){this.$container.find(".wc-"+this.id_dasherized+"-error").remove();try{V.init({apikey:this.api_key,settings:this.settings,paymentRequest:this.get_payment_request()})}catch(e){this.$container.before('<p class="wc-'+this.id_dasherized+'-error">'+this.i18n.initialization_error_message+"</p>"),this.hide_button(),console.error("[Visa Checkout] An error occurred trying to initialize Visa Checkout"),console.error(e)}}},{key:"get_payment_request",value:function(){var e=t("#wc-"+this.id_dasherized+"-payment-request").val();if(!e)throw new Error("Visa Checkout payment request is empty.");try{return t.parseJSON(e)}catch(e){throw e}}},{key:"add_event_handlers",value:function(){t(document.body).on("click",'input[name="payment_method"]',this.toggle_order_button.bind(this)),t(document.body).on("payment_method_selected",this.toggle_order_button.bind(this)),this.form.on("click",".v-button",this.block_ui.bind(this)),V.on("payment.success",this.on_payment_success.bind(this)),V.on("payment.cancel",this.on_payment_cancel.bind(this)),V.on("payment.error",this.on_payment_error.bind(this))}},{key:"show_button",value:function(){this.$container.show()}},{key:"hide_button",value:function(){this.$container.hide()}},{key:"toggle_order_button",value:function(){this.is_selected()?t("#place_order").addClass("wc-visa-checkout-hidden-place-order-button"):t("#place_order").removeClass("wc-visa-checkout-hidden-place-order-button")}},{key:"is_selected",value:function(){return this.id===this.get_selected_gateway_id()}},{key:"get_selected_gateway_id",value:function(){return this.form.find('input[name="payment_method"]:checked').val()}},{key:"on_payment_success",value:function(e){e.vInitRequest&&delete e.vInitRequest,t("#wc-"+this.id_dasherized+"-payment-response").val(JSON.stringify(e)),this.form.submit()}},{key:"on_payment_cancel",value:function(e){this.unblock_ui(),console.log("[Visa Checkout] Payment cancelled.",e)}},{key:"on_payment_error",value:function(e,t){this.render_errors([this.params.visa_checkout_general_error]),console.error("[Visa Checkout] "+t.code+": "+t.message)}}]),n),window.onVisaCheckoutReady=function(){void 0!==window.wc_cybersource_credit_card_visa_checkout_handler&&window.wc_cybersource_credit_card_visa_checkout_handler.init()},t(document.body).trigger("wc_cybersource_visa_checkout_payment_form_handler_loaded")});