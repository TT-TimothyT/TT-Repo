Vue.component("wcap-thumbnail",{props:["value","templates","keyt","showThumbnail"],data:function(){return{count:0}},template:`
			<div class="col-sm-12 col-md-3 col-lg-3 wcap-container text-center">
				<label :for="keyt" class="wcap-image-label">
					<input 
						type="radio" 
						name="wcap-template-select" 
						:id="keyt" 
						:value="keyt" 
						class="wcap-radio" 
						v-model="wcap_template"
					>
					<img v-bind:src="templates.url" class="wcap-image">
					Template {{keyt}}
				<button class="wcap-preview-btn" v-on:click="clickMethodPreview"><span class="dashicons dashicons-search"></span></button>
				</label>
			</div>`,methods:{clickMethodPreview:function(e){this.$root.showThumbnail=!1,this.$root.label=this.templates.url,this.$root.wcap_template_selected=this.templates.html}},computed:{wcap_template:{get:function(){return this.value},set:function(){this.$emit("checked",this.templates.html)}}}});var edit_template=new Vue({el:"#secondary-nav-wrap",data:()=>({settings:{},currentSettingsTab:"email_templates",settings_tabs:[{id:"email_templates",text:"Email Templates"},{id:"sms_notifications",text:"SMS Notifications"},{id:"facebook_messenger",text:"Facebook Messenger"}],saving:!1,saved_message:!1,message:wcap_send_manual_email.message_loading,message_saved:"",popup_data:"",showThumbnail:!0,label:"",templateList:wcap_template_params,wcap_template_selected:null}),mounted:function(){this.get_template_data()},methods:{get_template_data:function(){var e=new FormData;e.append("action","wcap_change_manual_email_data"),e.append("wcap_template_id",jQuery("#wcap_manual_template_name").val());var t=this;this.saving=!0,jQuery("#ac_events_loader").show(),axios.post(ajaxurl,e).then(function(e){this.saving=!1,jQuery("#ac_events_loader").hide(),t.settings=e.data;var a=t.settings.discount_expiry.split("-");t.settings.wcac_coupon_expiry=a[0],t.settings.expiry_day_or_hour=a[1],wcap_body=t.settings.body,jQuery("#wp-woocommerce_ac_email_body-wrap").hasClass("tmce-active")?tinyMCE.activeEditor.setContent(wcap_body):jQuery("#woocommerce_ac_email_body").val(wcap_body)}).catch(function(e){jQuery("#ac_events_loader").hide()})},set_popup_data:function(e){jQuery("#ac_events_loader").show();var t=new FormData;t.append("action",e);var a="";a=jQuery("#wp-woocommerce_ac_email_body-wrap").hasClass("tmce-active")?tinyMCE.get("woocommerce_ac_email_body").getContent():jQuery("#woocommerce_ac_email_body").val(),a=jQuery("<div />").text(a).html(),t.append("wc_template_header",this.settings.wc_email_header),t.append("body_email_preview",a),t.append("send_email_id",jQuery("#send_test_email").val());var s=this;this.saving=!0,jQuery("#ac_events_loader").show(),s.popup_data="",axios.post(ajaxurl,t).then(function(e){s.saving=!1,jQuery("#ac_events_loader").hide(),s.popup_data=this.popup_data=e.data}).catch(function(e){jQuery("#ac_events_loader").hide()})},wcap_send_test_email:function(e=!1){if(t="",e){var t=jQuery("#send_test_email_preview").val(),a=jQuery(e).data("wcap-email-type");"wc_preview"==a?l="true":"normal_preview"==a&&(l="false")}else void 0!==this.settings.send_test_email_preview&&(t=this.settings.send_test_email_preview);if(!t.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)){e?(jQuery("#preview_test_email_sent_msg").html(wcap_send_manual_email.wcap_email_warn_message),jQuery("#preview_test_email_sent_msg").fadeIn(),setTimeout(function(){jQuery("#preview_test_email_sent_msg").fadeOut()},3e3)):(jQuery("#preview_email_sent_msg").html(wcap_send_manual_email.wcap_email_warn_message),jQuery("#preview_email_sent_msg").fadeIn(),setTimeout(function(){jQuery("#preview_email_sent_msg").fadeOut()},3e3));return}jQuery("#ac_events_loader").show();var s=new FormData;s.append("send_email_id",t),s.append("action","wcap_preview_email_sent");var c="";c=jQuery("#wp-woocommerce_ac_email_body-wrap").hasClass("tmce-active")?tinyMCE.get("woocommerce_ac_email_body").getContent():jQuery("#woocommerce_ac_email_body").val();var l=this.settings.is_wc_template;c=jQuery("<div />").text(c).html(),s.append("body_email_preview",c),s.append("subject_email_preview",this.settings.subject),s.append("send_email_id",t),s.append("is_wc_template",l),s.append("wc_template_header",this.settings.wc_email_header),jQuery("#ac_events_loader").show(),axios.post(ajaxurl,s).then(function(t){jQuery("#ac_events_loader").hide();var a=wcap_send_manual_email.wcap_email_sent_image_path;flash_div=jQuery("#preview_email_sent_msg"),e&&(flash_div=jQuery("#preview_test_email_sent_msg")),jQuery(flash_div).html("<img style = 'height: 18px; width:20px;' src="+a+"> &nbsp;Email has been sent successfully."),jQuery(flash_div).fadeIn(),setTimeout(function(){jQuery(flash_div).fadeOut()},3e3)}).catch(function(e){jQuery("#ac_events_loader").hide()})},wcap_send_email:function(){var e=this,t=new FormData;Object.entries(e.settings).forEach(([e,a])=>{"body"!==e&&t.append(e,a)});var a="";a=jQuery("#wp-woocommerce_ac_email_body-wrap").hasClass("tmce-active")?tinyMCE.get("woocommerce_ac_email_body").getContent():jQuery("#woocommerce_ac_email_body").val(),a=jQuery("<div />").text(a).html(),t.append("wcap_wc_email_header",jQuery("#wcap_wc_email_header").val()),t.append("abandoned_cart_id",jQuery("#abandoned_cart_id").val()),t.append("wcap_manual_template_name",jQuery("#wcap_manual_template_name").val()),t.append("woocommerce_ac_email_body",a),t.append("coupon_ids_new",jQuery("#coupon_ids").val()),t.append("action","wcap_send_manual_email"),axios.post(ajaxurl,t).then(function(t){t.data.success&&(e.update_notification=t.data,e.message_saved=e.update_notification.success,e.saving=!1,e.saved_message=!0,setTimeout(()=>{document.getElementById("save_message").scrollIntoView({behavior:"smooth",block:"end"})}))}).catch(function(e){})},back_wcap_order_list:function(){window.history.back()},change_link:function(e,t){event.target.href=event.target.href+e},clickMethod:function(e){this.showThumbnail=!1,this.label=e.text},on_select:function(e){this.wcap_template_selected=e},wcap_view_back:function(){this.showThumbnail=!0,this.wcap_template_selected=null},wcap_insert_html:function(){this.wcap_template_selected&&axios.get(this.wcap_template_selected).then(function(e){if(jQuery("#wcap-preview-modal").modal("hide"),jQuery("#wp-woocommerce_ac_email_body-wrap").hasClass("html-active"))jQuery("#woocommerce_ac_email_body").val(e.data);else{var t=tinyMCE.get("woocommerce_ac_email_body");null!==t&&t.setContent(e.data)}}).catch(function(e){console.log(e)})},add_rule:function(){this.settings.rules.push({rule_type:"",rule_condition:"",rule_value:[],rule_text:[],rule_selText:"",edit:!0,add:!0})},save_rule:function(e,t){t.rule_type,t.rule_condition;var a=[];selected_vals=jQuery("#wcap_rule_value_"+e).val(),"SELECT"==jQuery("#wcap_rule_value_"+ +e)[0].tagName?jQuery("#wcap_rule_value_"+e+" option").each(function(){var e=jQuery(this);if(e.length){if(optval=e.val(),jQuery.isArray(selected_vals))for(i=0;i<selected_vals.length;i++)selected_vals[i]==optval&&a.push(e.text());else if(("string"==typeof selected_vals||selected_vals instanceof String)&&selected_vals==optval)return a.push(e.text()),!1}}):"INPUT"==jQuery("#wcap_rule_value_"+ +e)[0].tagName&&a.push(selected_vals),this.settings.rules[e].rule_selText=a.join(", "),this.settings.rules[e].rule_selText=a.join(", "),this.settings.rules[e].edit=!1,this.settings.rules[e].add=!1},update_rule:function(e,t){t.rule_type,t.rule_condition;var a=[];selected_vals=jQuery("#wcap_rule_value_"+e).val(),"SELECT"==jQuery("#wcap_rule_value_"+ +e)[0].tagName?jQuery("#wcap_rule_value_"+e+" option").each(function(){var e=jQuery(this);if(e.length){if(optval=e.val(),jQuery.isArray(selected_vals))for(i=0;i<selected_vals.length;i++)selected_vals[i]==optval&&a.push(e.text());else if(("string"==typeof selected_vals||selected_vals instanceof String)&&selected_vals==optval)return a.push(e.text()),!1}}):"INPUT"==jQuery("#wcap_rule_value_"+ +e)[0].tagName&&a.push(selected_vals),this.settings.rules[e].rule_selText=a.join(", "),this.settings.rules[e].edit=!1,this.settings.rules[e].add=!1},edit_rule:function(e,t){var a={rule_type:t.rule_type,rule_condition:t.rule_condition,rule_value:t.rule_value,rule_text:t.rule_text,rule_selText:"",edit:!0,add:!1};Vue.set(this.settings.rules,e,a)},delete_rule:function(e){this.settings.rules.splice(e,1)},wcap_rule_values:function(e){object_id=e.target.id,this.wcap_trigger_selectwoo(object_id)},wcap_trigger_selectwoo:function(e){var t=document.getElementById(e).value,a=e.substr(-1),s="wcap_rule_value_"+a,c=document.getElementById(s),l=document.getElementById("wcap_rule_condition_"+a);if(""!==t){for(;l.options.length>0;)l.remove(0);switch(t){case"cart_items_count":case"cart_total":var n=Object.entries(wcap_send_manual_email.wcap_counts);for(let[r,o]of n){let d=new Option(`${o}`,`${r}`);l.add(d,void 0)}l.removeAttribute("style");break;default:var p=Object.entries(wcap_send_manual_email.wcap_cond_includes);for(let[u,m]of p){let w=new Option(`${m}`,`${u}`);l.add(w,void 0)}l.setAttribute("style","width: 80%;")}if("SELECT"===c.nodeName){for(;c.options.length>0;)c.remove(0);c.removeAttribute("onChange")}if(jQuery("#"+s).hasClass("select2-hidden-accessible")){jQuery("#"+s).select2("destroy"),document.querySelector(s);let h=document.createElement("select");h.setAttribute("class","wcap_rule_value"),h.setAttribute("id",s),h.setAttribute("name",s),c.parentNode.replaceChild(h,c),c=document.getElementById(s)}switch(t){case"send_to":c.setAttribute("onChange","wcap_rule_value_updated( this.id )"),c.setAttribute("class","wcap_rule_value wc-product-search"),c.setAttribute("multiple","multiple"),c.setAttribute("data-action","wcap_json_find_send_to"),c.setAttribute("name",s+"[]"),c.setAttribute("data-placeholder",wcap_send_manual_email.wcap_send_to_select),c.setAttribute("style","width:90%;"),jQuery(".wc-product-search").selectWoo(),jQuery(document.body).trigger("wc-enhanced-select-init");break;case"cart_items_count":case"cart_total":document.querySelector(s);let v=document.createElement("input");v.setAttribute("class","wcap_rule_value"),v.setAttribute("type","number"),v.setAttribute("id",s),v.setAttribute("name",s),v.min=1,c.parentNode.replaceChild(v,c);break;case"payment_gateways":var b=Object.entries(wcap_send_manual_email.wcap_payment_gateways);for(let[g,f]of b){let y=new Option(`${f}`,`${g}`);c.add(y,void 0)}break;case"cart_items":c.setAttribute("class","wcap_rule_value wc-product-search"),c.setAttribute("multiple","multiple"),c.setAttribute("data-action","wcap_json_find_products"),c.setAttribute("name",s+"[]"),c.setAttribute("data-placeholder",wcap_send_manual_email.wcap_product_select),c.setAttribute("style","width:90%;"),jQuery(".wc-product-search").selectWoo(),jQuery(document.body).trigger("wc-enhanced-select-init");break;case"coupons":c.setAttribute("class","wcap_rule_value wc-product-search"),c.setAttribute("multiple","multiple"),c.setAttribute("data-action","wcap_json_find_coupons"),c.setAttribute("name",s+"[]"),c.setAttribute("data-placeholder",wcap_send_manual_email.wcap_coupon_select),c.setAttribute("style","width:90%;"),jQuery(".wc-product-search").selectWoo(),jQuery(document.body).trigger("wc-enhanced-select-init");break;case"product_cat":var A=document.getElementById(a).cells[2];console.log(A),c.setAttribute("class","wcap_rule_value wc-product-search"),c.setAttribute("multiple","multiple"),c.setAttribute("data-action","wcap_json_find_product_cat"),c.setAttribute("name",s+"[]"),c.setAttribute("data-placeholder",wcap_send_manual_email.wcap_prod_cat_select),c.setAttribute("style","width:90%;"),jQuery(".wc-product-search").selectWoo(),jQuery(document.body).trigger("wc-enhanced-select-init");break;case"product_tag":c.setAttribute("class","wcap_rule_value wc-product-search"),c.setAttribute("multiple","multiple"),c.setAttribute("data-action","wcap_json_find_product_tag"),c.setAttribute("name",s+"[]"),c.setAttribute("data-placeholder",wcap_send_manual_email.wcap_prod_tag_select),c.setAttribute("style","width:90%;"),jQuery(".wc-product-search").selectWoo(),jQuery(document.body).trigger("wc-enhanced-select-init");break;case"cart_status":c.setAttribute("class","wcap_rule_value wc-product-search"),c.setAttribute("multiple","multiple"),c.setAttribute("data-action","wcap_json_find_cart_status"),c.setAttribute("name",s+"[]"),c.setAttribute("data-placeholder",wcap_send_manual_email.wcap_cart_status_select),c.setAttribute("style","width:90%;"),jQuery(".wc-product-search").selectWoo(),jQuery(document.body).trigger("wc-enhanced-select-init");break;case"countries":c.setAttribute("class","wc-enhanced-select"),c.setAttribute("multiple","multiple"),c.setAttribute("name",s+"[]");var $=Object.entries(wcap_send_manual_email.wcap_available_countries);for(let[x,k]of $){let _=new Option(`${k}`,`${x}`);jQuery("#"+s).append(_,void 0)}jQuery("#"+s).select2();break;case"order_status":c.setAttribute("class","wcap_rule_value wc-product-search"),c.setAttribute("multiple","multiple"),c.setAttribute("data-action","wcap_json_find_order_status"),c.setAttribute("name",s+"[]"),c.setAttribute("data-placeholder",wcap_send_manual_email.wcap_order_status_select),c.setAttribute("style","width:90%;"),jQuery(".wc-product-search").selectWoo(),jQuery(document.body).trigger("wc-enhanced-select-init")}}}}});function wcap_rule_value_updated(e){var t=document.getElementById(e),a=getSelectValues(t),s=t.parentNode,c=document.getElementById("wcap_rules_email_addresses");if(-1!=a.indexOf("email_addresses")&&null===c){var l=document.createElement("textarea");l.setAttribute("rows",3),l.setAttribute("cols",35),l.setAttribute("name","wcap_rules_email_addresses"),l.setAttribute("id","wcap_rules_email_addresses"),l.setAttribute("style","margin-top: 10px;"),l.setAttribute("placeholder","Please enter email addresses separated by a comma"),l.innerHTML="",s.append(l)}else -1==a.indexOf("email_addresses")&&null!==c&&c.parentNode.removeChild(c)}jQuery(".ac-import-template").on("click",function(){var e;if(e){e.open();return}(e=wp.media({className:"media-frame",library:{type:"text",subtype:"html"},menu:"default",view:{EmbedUrl:!0},editing:!0,title:"Select or Upload HTML Files",button:{text:"Import this file"},multiple:!1})).on("select",function(){var t=e.state().get("selection").first().toJSON();axios.get(t.url).then(function(e){if(jQuery("#wcap-preview-modal").modal("hide"),jQuery("#wp-woocommerce_ac_email_body-wrap").hasClass("html-active"))jQuery("#woocommerce_ac_email_body").val(e.data);else{var t=tinyMCE.get("woocommerce_ac_email_body");null!==t&&t.setContent(e.data)}}).catch(function(e){console.log(e)})}),e.open()}),jQuery(document.body).on("click","#preview_test_email",function(){edit_template.wcap_send_test_email(this)});